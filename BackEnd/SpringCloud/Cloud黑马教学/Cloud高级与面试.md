## Sentinel

<br>

### 介绍

Sentinel 是一个开源的分布式系统，用于监控和管理其他系统的可用性和状态。

Sentinel 主要用于监控 Redis 实例的健康状况，并在主从复制架构中自动进行故障检测和故障转移。当主节点发生故障或不可用时，Sentinel 会自动选举新的主节点，并将客户端的请求重定向到新的主节点，以确保系统的可用性。

<br>

雪崩：微服务集群中的任意一个服务器挂了，导致依赖它的服务器全部挂掉（链式反应，一条链路上的所有服务器统统挂掉）

解决雪崩问题：

1. 超时处理：设定超时时间，一旦超时无响应就返回错误信息，不会阻塞等待
2. 仓壁模式（线程隔离模式）：限定每个业务可调用线程数，避免耗尽 tomcat
3. 熔断降级：断路器统计业务中的异常比例，超出阈值直接断开，拦截一切请求
4. 流量控制：限制服务器访问的 QPS

<br>

### 限流准则

![](../img/cloud-hm-senior/s1.png)

簇点链路：链路监控对应的接口，而这些接口就称为一个资源；可以对这些接口执行限流，比如限制 QPS

<br>

![](../img/cloud-hm-senior/s2.png)

流控模式及其使用场景

关联模式：用户支付会触发修改和查询行为，二者同时竞争数据库锁，容易发生竞态条件，所以触发修改业务时需要关联的对查询业务进行限流  
关联模式使用场景：两个竞争关系的资源；一个高优先级，一个低优先级；

链路模式：查询订单和创建订单均需要 URL 跳转到查询商品业务，很显然我们需要优先保证创建订单任务，故对查询订单跳转执行限流

<brs>

![](../img/cloud-hm-senior/s3.png)

流控效果

warm-up 启动方式可以缓解冷启动效果  
初始 QPS 阈值会逐渐在指定时间内增加到最大 QPS 阈值，然后超出此 QPS 的请求均被丢弃

<br>

热点参数限流：针对统一参数的请求数量进行统计，以便执行限流

<br>

### 隔离与降级
