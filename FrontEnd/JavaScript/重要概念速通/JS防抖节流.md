---
title: JS防抖节流
date: 2022-07-21 14:20:41
tags:

categories:
  - 前端面试八股
---

### 防抖

**概念以及解释**  
定义：在一段时间内只能执行一次；

举个栗子：  
当你不控制游戏人物一刻起，就设置一个 10min 的倒计时，  
时间一到，游戏人物就进入待机状态，  
当你再次唤醒他的时候，立刻清除倒计时，直到下一次游戏人物失去控制时开始，  
（即每次激活都清除一次倒计时时钟）

> 防抖函数常用语阻止用户重复提交表单数据

<br>

**手写实战**  
我们要实现的是：防止用户多次点击按钮导致的 `重复提交问题`；  
即当用户首次点击时立刻启动定时器，若在此期间又点击了第二次，则定时器重启，导致信息永远无法提交，直到用户别再倒计时内乱点按钮为止！

运行过程：

1. 运行防抖函数时，首先清除定时器 timer
2. 因为 func 是一个函数，且参数不固定，所以需要使用 arguments 获取所有参数！
3. 然后立即设置一个定时器，并配合 apply 方法设置 func 函数的上下文为当前的匿名函数，并因此可以将 arguments 传入！！！
4. 直到整个 settimeout 执行完毕后，才会真正执行一次函数

```js
function customDebounce(func, time) {
  let timer;
  return function () {
    clearTimeout(timer);
    let args = arguments;
    timer = setTimeout(() => {
      func.apply(this, args);
    }, time);
  };
}
```

<br>

### 节流

**简要概念**  
定义：两次触发事件的间隔必须是固定的；

举个栗子：  
假设触发事件为鼠标滚动，且两次事件间隔时间为 t  
第一次鼠标滚动立即触发事件，并记录当前时间戳为 t1  
之后无论鼠标滚动多少次，都判断本次鼠标滚动时间戳 t2 是否符合等式：t2-t1=t  
如果相等，则第二次触发鼠标滚动事件，计时器重新计时...

<br>

**手写节流**

```js
function throttle(func, time) {
  let t1 = 0;
  return function () {
    let t2 = new Date();
    if (t2 - t1 > time) {
      func();
      t1 = t2; // 重置计时器
    }
  };
}
```

<br>
